{% extends "main/base/index.html" %}
{% block content %}


<title>Forms</title>


<style media="screen">
  body {
    word-break: break-all;
  }

  .cred {
    width: 55%;
    min-width: 320px;
  }
</style>

<center>

  <div class="card cred anime" style="background-color:#fffde8;" id="enable">

    <div class="card-content">
      <div class="content has-text-centered">Please fill up<br><br>
        <div class="field">
          <p class="control has-icons-left"><input style="background-color:#fcfbf0;" id="name" class="input" type="text" placeholder="Enter your name"><span class="icon is-small is-left"><i class="fa fa-user"></i></span></p>
        </div>
        <div class="field">
          <p class="control has-icons-left"><input style="background-color:#fcfbf0;" id="email" class="input" type="email" placeholder="Enter your e-mail"><span class="icon is-small is-left"><i class="fa fa-envelope"></i></span></p>
        </div>
        <div class="field">
          <p class="control has-icons-left"><input style="background-color:#fcfbf0;" id="number" class="input" type="text" placeholder="Enter your phone number"><span class="icon is-small is-left"><i class="fa fa-phone"></i></span></p>
        </div>
        <button class="button is-primary is-outlined" onclick="send_cred_to_server();">Enter</button>
      </div>
    </div>
  </div>

  <div id="msg_box" hidden>
    <br><br>
    <article class="message is-warning" style="width: 50%; margin: auto;">
      <div class="message-header">
        <p>Alert</p><button class="delete" aria-label="delete" onclick="delete_msg();"></button>
      </div>
      <div class="message-body" id="msg_content"></div>
    </article>
  </div>

{% csrf_token %}

</center>

<script type="text/javascript">

  function validateEmail(email) {
    const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(email);
  }

  function delete_msg() {
    $('#msg_box').hide();
  }

  function show_msg(string) {
    $("#msg_box").fadeIn();
    document.getElementById('msg_content').innerHTML = string;
  }

  function send_cred_to_server() {
    let name = document.getElementById('name').value;
    let email = document.getElementById('email').value;
    let number = document.getElementById('number').value;
    if (name == "" || email == "" || number == "") {
      show_msg("Please fill the form properly");
      return false;
    } else if((/^[0-9]*$/gm.test(name))){
      show_msg("Name cannot be numeric");
    }else if (!validateEmail(email)) {
      show_msg("Enter a valid mail");
      return false;
    } else if (!(/^[0-9]*$/gm.test(number)) || number.length < 11) {
      show_msg("Enter your phone number correctly");
      return false;
    }


    $.ajax({
      url: 'home', //self-calling
      data: {
        credentials: {
          'name': name,
          'email': email,
          'number': number,
          'ID': ques_id
        },
        csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value
      },
      type: 'POST',
      dataType: 'json',
      cache: false,
      success: function(data) {
        console.log(1111111111);
      },
      error: function() {
        console.log("Image is not uploaded, please try again");
      }
    });

  }
</script>

{% endblock %}
